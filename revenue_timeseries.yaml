name: REVENUE
description: Revenue analytics semantic model grounded on daily revenue, COGS, forecasts, with product and region dimensions.
tables:
  - name: DAILY_REVENUE
    description: Daily total revenue, aligned with daily COGS and forecasted revenue.
    base_table:
      database: CORTEX_DB
      schema: SABIH
      table: DAILY_REVENUE
    dimensions:
      - name: PRODUCT_ID
        expr: product_id
        data_type: NUMBER(38,0)
      - name: REGION_ID
        expr: region_id
        data_type: NUMBER(38,0)
    time_dimensions:
      - name: DATE
        description: Date of observation with measures of revenue, COGS, and forecasted revenue.
        expr: date
        data_type: DATE
        unique: false
    facts:
      - name: DAILY_COGS
        synonyms:
          - cost
          - expenditures
        description: Total cost of goods sold for the given day
        expr: cogs
        data_type: FLOAT
        access_modifier: public_access
        default_aggregation: sum
      - name: DAILY_FORECAST_ABS_ERROR
        synonyms:
          - absolute error
          - L1
        description: Absolute error between forecasted and actual revenue (MAE when averaged).
        expr: abs(forecasted_revenue - revenue)
        data_type: FLOAT
        access_modifier: public_access
        default_aggregation: avg
      - name: DAILY_FORECASTED_REVENUE
        synonyms:
          - forecasted income
          - forecasted sales
        description: Total forecasted revenue for a given day
        expr: forecasted_revenue
        data_type: FLOAT
        access_modifier: public_access
        default_aggregation: sum
      - name: DAILY_PROFIT
        description: Profit is revenue minus COGS.
        expr: revenue - cogs
        data_type: FLOAT
        access_modifier: public_access
        default_aggregation: sum
      - name: DAILY_REVENUE
        synonyms:
          - income
          - sales
        description: Total revenue for the given day
        expr: revenue
        data_type: FLOAT
        access_modifier: public_access
        default_aggregation: sum
    primary_key:
      columns:
        - DATE
        - PRODUCT_ID
        - REGION_ID
  - name: PRODUCT
    description: Product dimension table with unique product identifiers and attributes.
    base_table:
      database: CORTEX_DB
      schema: SABIH
      table: PRODUCT_DIM
    dimensions:
      - name: PRODUCT_ID
        expr: product_id
        data_type: NUMBER(38,0)
      - name: PRODUCT_LINE
        description: Product line associated with revenue
        expr: product_line
        data_type: VARCHAR(16777216)
        sample_values:
          - Electronics
          - Clothing
          - Home Appliances
          - Toys
          - Books
    primary_key:
      columns:
        - PRODUCT_ID
  - name: REGION
    description: Region dimension table with unique region identifiers and geographic attributes.
    base_table:
      database: CORTEX_DB
      schema: SABIH
      table: REGION_DIM
    dimensions:
      - name: REGION_ID
        expr: region_id
        data_type: NUMBER(38,0)
      - name: SALES_REGION
        description: Region associated with revenue
        expr: sales_region
        data_type: VARCHAR(16777216)
        sample_values:
          - North America
          - Europe
          - Asia
          - South America
          - Africa
    primary_key:
      columns:
        - REGION_ID
relationships:
  - name: REVENUE_TO_PRODUCT
    left_table: DAILY_REVENUE
    right_table: PRODUCT
    relationship_columns:
      - left_column: PRODUCT_ID
        right_column: PRODUCT_ID
    relationship_type: many_to_one
    join_type: left_outer
  - name: REVENUE_TO_REGION
    left_table: DAILY_REVENUE
    right_table: REGION
    relationship_columns:
      - left_column: REGION_ID
        right_column: REGION_ID
    relationship_type: many_to_one
    join_type: left_outer
verified_queries:
  - name: daily cumulative expenses in 2023 dec
    question: daily cumulative expenses in 2023 dec
    sql: |-
      SELECT
        date,
        SUM(cogs) OVER (
          ORDER BY
            date ROWS BETWEEN UNBOUNDED PRECEDING
            AND CURRENT ROW
        ) AS cumulative_cogs
      FROM
        cortex_db.sabih.daily_revenue
      WHERE
        date BETWEEN '2023-12-01'
        AND '2023-12-31'
      ORDER BY
        date DESC;
    use_as_onboarding_question: false
    verified_by: Qazi Sabih
    verified_at: 1765111219
  - name: What is the total profit generated from electronics products over the entire period available in the data?
    question: What is the total profit generated from electronics products over the entire period available in the data?
    sql: |-
      SELECT
        p.product_line,
        MIN(dr.date) AS start_date,
        MAX(dr.date) AS end_date,
        SUM(dr.daily_profit) AS total_daily_profit
      FROM
        daily_revenue AS dr
        LEFT JOIN product AS p ON dr.product_id = p.product_id
      WHERE
        p.product_line = 'Electronics'
      GROUP BY
        p.product_line
    use_as_onboarding_question: false
    verified_by: Qazi Sabih
    verified_at: 1765111160
  - name: How did revenue, cost of goods sold, and profit by product line trend each month from July to September 2024?
    question: How did revenue, cost of goods sold, and profit by product line trend each month from July to September 2024?
    sql: |-
      SELECT
        DATE_TRUNC('MONTH', dr.date) AS month,
        p.product_line,
        SUM(dr.daily_revenue) AS monthly_revenue,
        SUM(dr.daily_cogs) AS monthly_cogs,
        SUM(dr.daily_profit) AS monthly_profit
      FROM
        daily_revenue AS dr
        LEFT OUTER JOIN product AS p ON dr.product_id = p.product_id
      WHERE
        dr.date <= '2024-09-30'
        AND dr.date >= '2024-07-01'
      GROUP BY
        month,
        p.product_line
      ORDER BY
        month DESC NULLS LAST,
        p.product_line
    use_as_onboarding_question: false
    verified_by: Qazi Sabih
    verified_at: 1765111174
custom_instructions: |-
  ## Analyst Instructions
  You are a revenue analytics expert. Use the defined measures and dimensions,
  provide month/quarter/YTD views, compare YoY where relevant, and include SQL and table citations.
  Ask clarifying questions when intent or grain is ambiguous.
  Always ground answers on the semantic layer measures and dimensions and cite the underlying tables.
  Prefer grouping by product_line and sales_region when a segmentation is requested.
  Summarize insights and potential drivers in a concise narrative.

  ## Standard NLQ Prompt Templates
  Use the following prompt templates to structure queries. Variables in braces {â€¦} are placeholders to be filled.

  ### kpi_summary
  - Description: High-level KPIs over a specified period and grain.
  - Template:
    Provide {time_grain} KPIs for {date_range}. Include:
    - Total revenue (daily_revenue) and COGS (daily_cogs)
    - Profit (daily_profit) = revenue - cogs
    - YoY % change if the comparison period exists
    Group by: {group_by}
    Filters: {filters}
    Return: table + concise narrative with drivers and SQL (with citations).
  - Variables:
    - time_grain:
      - day
      - week
      - month
      - quarter
    - date_range:
      - last 3 months
      - Q3 2024
      - 2023-12-01 to 2023-12-31
      - YTD
    - group_by:
      - product_line
      - sales_region
      - product_id
      - region_id
    - filters:
      - product_line = 'Electronics'
      - sales_region IN ('Europe','Asia')
  - Examples:
    - Show monthly revenue, COGS, and profit by product_line for Q3 2024.
    - Daily KPIs last 30 days filtered to Europe.

  ### trend_analysis
  - Description: Time-series trend analysis with optional YoY and MoM deltas.
  - Template:
    Plot and summarize {measure} over {date_range} by {time_grain}.
    Show YoY and MoM deltas when applicable. Group by: {group_by}. Filters: {filters}.
    Include SQL and citations. Explain seasonality or anomalies if detected.
  - Variables:
    - measure:
      - daily_revenue
      - daily_cogs
      - daily_profit
      - daily_forecasted_revenue
    - time_grain:
      - day
      - week
      - month
    - date_range:
      - last 12 months
      - 2024
